<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ / è¨»å†Š | APCS å¤ªç©ºæ¢éšªèª²ç¨‹</title>
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .auth-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 3rem;
            max-width: 450px;
            width: 100%;
        }
        
        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .auth-tab.active {
            color: var(--energy-cyan);
            border-bottom-color: var(--energy-cyan);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.875rem;
            font-size: 1rem;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--energy-cyan);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }
        
        .form-button {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--energy-cyan), var(--neon-purple));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }
        
        .form-button:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.4);
        }
        
        .form-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .divider span {
            padding: 0 1rem;
        }
        
        .google-button {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            background: white;
            color: #333;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }
        
        .google-button:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }
        
        .message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 10px;
            display: none;
            text-align: center;
        }
        
        .message.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4caf50;
            color: #4caf50;
        }
        
        .message.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #f44336;
        }
        
        .message.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196f3;
            color: #2196f3;
        }
        
        .verification-section {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: 10px;
        }
        
        .verification-section.active {
            display: block;
        }
        
        .back-link {
            text-align: center;
            margin-top: 1.5rem;
        }
        
        .back-link a {
            color: var(--energy-cyan);
            text-decoration: none;
        }
        
        .back-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <canvas id="starfield" class="starfield"></canvas>
    
    <div class="auth-container">
        <div class="auth-box">
            <h1 style="text-align: center; color: var(--energy-cyan); margin-bottom: 2rem;">
                ğŸš€ APCS å¤ªç©ºæ¢éšª
            </h1>
            
            <!-- æ¨™ç±¤åˆ‡æ› -->
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login', event)">ç™»å…¥</button>
                <button class="auth-tab" onclick="switchTab('register', event)">è¨»å†Š</button>
            </div>
            
            <!-- ç™»å…¥è¡¨å–® -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å¯†ç¢¼</label>
                    <input type="password" class="form-input" id="loginPassword" required placeholder="è‡³å°‘ 6 å€‹å­—ç¬¦">
                </div>
                
                <button type="submit" class="form-button">ğŸ”“ ç™»å…¥</button>
                
                <div class="divider">
                    <span>æˆ–</span>
                </div>
                
                <button type="button" class="google-button" onclick="handleGoogleLogin()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                        <path fill="none" d="M0 0h48v48H0z"/>
                    </svg>
                    ä½¿ç”¨ Google ç™»å…¥
                </button>
            </form>
            
            <!-- è¨»å†Šè¡¨å–® -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">å§“å</label>
                    <input type="text" class="form-input" id="registerName" required placeholder="æ‚¨çš„å§“å">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" required placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å¯†ç¢¼</label>
                    <input type="password" class="form-input" id="registerPassword" required placeholder="è‡³å°‘ 6 å€‹å­—ç¬¦" minlength="6">
                </div>
                
                <button type="submit" class="form-button">ğŸ“ è¨»å†Š</button>
                
                <div class="divider">
                    <span>æˆ–</span>
                </div>
                
                <button type="button" class="google-button" onclick="handleGoogleLogin()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                        <path fill="none" d="M0 0h48v48H0z"/>
                    </svg>
                    ä½¿ç”¨ Google è¨»å†Š
                </button>
                
                <!-- Email é©—è­‰å€åŸŸ -->
                <div id="verificationSection" class="verification-section">
                    <h3 style="color: #2196f3; margin-bottom: 1rem;">ğŸ“§ é©—è­‰æ‚¨çš„ Email</h3>
                    <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 1rem;">
                        æˆ‘å€‘å·²ç™¼é€é©—è­‰ç¢¼åˆ°æ‚¨çš„ Emailï¼ˆé–‹ç™¼ç’°å¢ƒä¸‹æœƒé¡¯ç¤ºåœ¨ä¸‹æ–¹ï¼‰
                    </p>
                    <div class="form-group">
                        <label class="form-label">é©—è­‰ç¢¼</label>
                        <input type="text" class="form-input" id="verificationCode" placeholder="6 ä½æ•¸å­—" maxlength="6">
                    </div>
                    <button type="button" class="form-button" onclick="handleVerifyEmail()">
                        âœ… é©—è­‰ Email
                    </button>
                </div>
            </form>
            
            <!-- è¨Šæ¯é¡¯ç¤º -->
            <div id="message" class="message"></div>
            
            <!-- è¿”å›é¦–é  -->
            <div class="back-link">
                <a href="index.html">â† è¿”å›é¦–é </a>
            </div>
        </div>
    </div>
    
    <script src="scripts/starfield.js"></script>
    <script src="scripts/auth-client.js"></script>
    <script>
        let currentEmail = '';
        let currentVerificationCode = '';
        
        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tab, event) {
            // æ›´æ–°æ¨™ç±¤æ¨£å¼
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ›´æ–°è¡¨å–®é¡¯ç¤º
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
            
            // æ¸…é™¤è¨Šæ¯
            hideMessage();
        }
        
        // è™•ç†ç™»å…¥
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = event.target.querySelector('.form-button');
            
            btn.disabled = true;
            showMessage('ç™»å…¥ä¸­...', 'info');
            
            const result = await window.authClient.login(email, password);
            
            if (result.success) {
                showMessage('âœ… ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...', 'success');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
            } else {
                showMessage('âŒ ' + result.message, 'error');
                btn.disabled = false;
            }
        }
        
        // è™•ç†è¨»å†Š
        async function handleRegister(event) {
            event.preventDefault();
            console.log('é–‹å§‹è¨»å†Šæµç¨‹...');
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const btn = event.target.querySelector('.form-button');
            
            console.log('è¨»å†Šè³‡æ–™:', { name, email, password: '***' });
            
            btn.disabled = true;
            showMessage('è¨»å†Šä¸­...', 'info');
            
            const result = await window.authClient.register(email, password, name);
            console.log('è¨»å†Šçµæœ:', result);
            
            if (result.success) {
                currentEmail = email;
                currentVerificationCode = result.verificationCode; // é–‹ç™¼ç’°å¢ƒ
                
                showMessage('âœ… è¨»å†ŠæˆåŠŸï¼è«‹é©—è­‰æ‚¨çš„ Email', 'success');
                
                // é¡¯ç¤ºé©—è­‰å€åŸŸ
                document.getElementById('verificationSection').classList.add('active');
                
                // é–‹ç™¼ç’°å¢ƒï¼šè‡ªå‹•å¡«å…¥é©—è­‰ç¢¼
                if (result.verificationCode) {
                    document.getElementById('verificationCode').value = result.verificationCode;
                    showMessage(`âœ… è¨»å†ŠæˆåŠŸï¼é©—è­‰ç¢¼ï¼š${result.verificationCode}`, 'success');
                }
                
                btn.disabled = false;
            } else {
                showMessage('âŒ ' + result.message, 'error');
                btn.disabled = false;
            }
        }
        
        // è™•ç† Email é©—è­‰
        async function handleVerifyEmail() {
            const code = document.getElementById('verificationCode').value;
            
            if (!code || code.length !== 6) {
                showMessage('âŒ è«‹è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼', 'error');
                return;
            }
            
            showMessage('é©—è­‰ä¸­...', 'info');
            
            const result = await window.authClient.verifyEmail(currentEmail, code);
            
            if (result.success) {
                showMessage('âœ… Email é©—è­‰æˆåŠŸï¼æ­£åœ¨è‡ªå‹•ç™»å…¥...', 'success');
                
                // è‡ªå‹•ç™»å…¥
                setTimeout(async () => {
                    const password = document.getElementById('registerPassword').value;
                    const loginResult = await window.authClient.login(currentEmail, password);
                    
                    if (loginResult.success) {
                        window.location.href = 'dashboard.html';
                    }
                }, 1500);
            } else {
                showMessage('âŒ ' + result.message, 'error');
            }
        }
        
        // è™•ç† Google ç™»å…¥
        async function handleGoogleLogin() {
            showMessage('æ­£åœ¨è·³è½‰åˆ° Google...', 'info');
            await window.authClient.googleLogin();
        }
        
        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
        }
        
        // éš±è—è¨Šæ¯
        function hideMessage() {
            const messageDiv = document.getElementById('message');
            messageDiv.style.display = 'none';
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        if (window.authClient.isLoggedIn()) {
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>
