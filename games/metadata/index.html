<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAE 遊戲管理系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .difficulty-1 { background-color: #d4edda; }
        .difficulty-2 { background-color: #fff3cd; }
        .difficulty-3 { background-color: #f8d7da; }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 12px;
            background-color: #e9ecef;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>FAE 遊戲管理系統</h1>
        
        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        篩選器
                    </div>
                    <div class="card-body">
                        <h5>難度</h5>
                        <div id="difficulty-filter" class="mb-3">
                            <!-- 由 JavaScript 填充 -->
                        </div>
                        
                        <h5>類別</h5>
                        <div id="category-filter" class="mb-3">
                            <!-- 由 JavaScript 填充 -->
                        </div>
                        
                        <h5>年級</h5>
                        <div id="grade-filter" class="mb-3">
                            <!-- 由 JavaScript 填充 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <div class="mb-3">
                    <input type="text" id="search" class="form-control" placeholder="搜尋遊戲...">
                </div>
                
                <div id="games-container">
                    <!-- 由 JavaScript 填充 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let gamesData = null;
        let filters = {
            difficulty: [],
            categories: [],
            grade: []
        };

        async function loadGames() {
            const response = await fetch('games.json');
            gamesData = await response.json();
            renderFilters();
            renderGames();
        }

        function renderFilters() {
            // 難度篩選器
            const difficultyFilter = document.getElementById('difficulty-filter');
            gamesData.difficulties.forEach(diff => {
                const checkbox = document.createElement('div');
                checkbox.className = 'form-check';
                checkbox.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${diff.level}" id="diff-${diff.level}">
                    <label class="form-check-label" for="diff-${diff.level}">
                        ${diff.name}
                    </label>
                `;
                difficultyFilter.appendChild(checkbox);
            });

            // 類別篩選器
            const categoryFilter = document.getElementById('category-filter');
            gamesData.categories.forEach(cat => {
                const checkbox = document.createElement('div');
                checkbox.className = 'form-check';
                checkbox.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${cat.id}" id="cat-${cat.id}">
                    <label class="form-check-label" for="cat-${cat.id}">
                        ${cat.name}
                    </label>
                `;
                categoryFilter.appendChild(checkbox);
            });

            // 監聽篩選器變化
            document.querySelectorAll('.form-check-input').forEach(checkbox => {
                checkbox.addEventListener('change', renderGames);
            });

            // 監聽搜尋框
            document.getElementById('search').addEventListener('input', renderGames);
        }

        function renderGames() {
            const container = document.getElementById('games-container');
            const searchTerm = document.getElementById('search').value.toLowerCase();
            
            // 獲取選中的篩選器
            const selectedDifficulties = [...document.querySelectorAll('#difficulty-filter input:checked')]
                .map(input => parseInt(input.value));
            const selectedCategories = [...document.querySelectorAll('#category-filter input:checked')]
                .map(input => input.value);

            // 篩選遊戲
            const filteredGames = gamesData.games.filter(game => {
                const matchesDifficulty = selectedDifficulties.length === 0 || 
                    selectedDifficulties.includes(game.difficulty);
                const matchesCategory = selectedCategories.length === 0 || 
                    game.tags.some(tag => selectedCategories.includes(tag.toLowerCase()));
                const matchesSearch = game.title.toLowerCase().includes(searchTerm) || 
                    game.description.toLowerCase().includes(searchTerm);

                return matchesDifficulty && matchesCategory && matchesSearch;
            });

            // 渲染遊戲卡片
            container.innerHTML = filteredGames.map(game => `
                <div class="card mb-3 difficulty-${game.difficulty}">
                    <div class="card-body">
                        <h5 class="card-title">${game.title}</h5>
                        <p class="card-text">${game.description}</p>
                        <div class="mb-2">
                            ${game.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div class="mb-2">
                            <small class="text-muted">
                                難度: ${getDifficultyName(game.difficulty)} | 
                                建議年級: ${game.recommendedGrade} | 
                                預計時間: ${game.estimatedTime}
                            </small>
                        </div>
                        <a href="${game.path}" class="btn btn-primary">開始遊戲</a>
                    </div>
                </div>
            `).join('');
        }

        function getDifficultyName(level) {
            return gamesData.difficulties.find(d => d.level === level)?.name || '未知';
        }

        // 載入遊戲數據
        loadGames();
    </script>
</body>
</html>
